# Question_Generation

## Introduction
[To be added]

## Installation
### Step 1: Clone the repository
```
git clone https://github.com/BPYap/Question-Generation
cd Question-Generation
```
### Step 2 (Optional): Setup virtual environment
Windows:
```
python3 -m virtualenv env
env\scripts\activate
```
Ubuntu:
```
python3 -m virtualenv env
source env/bin/activate
```
### Step 3: Install dependencies
```
pip install -r requirements.txt
python setup.py install
```
### Step 4: Download pretrained models
##### fastText
1. Download [fastText English vectors](https://fasttext.cc/docs/en/crawl-vectors.html) [[direct link](https://dl.fbaipublicfiles.com/fasttext/vectors-crawl/cc.en.300.bin.gz)]
2. Decompress and put `cc.en.300.bin` under `model/pretrained/fastText`directory
##### GloVe
1. Download [spaCy pretrained GloVe model](https://spacy.io/models/en#en_vectors_web_lg) [[direct link](https://github.com/explosion/spacy-models/releases/download/en_vectors_web_lg-2.1.0/en_vectors_web_lg-2.1.0.tar.gz)]
2. Decompress and put `en_vectors_web_lg-2.1.0` (the most inner folder) under `model/pretrained/spacy_glove` directory
##### Universal Sentence Encoder
1. Download the [transformer variant of Universal Sentence Encoder](https://tfhub.dev/google/universal-sentence-encoder-large/3) [[direct link](https://tfhub.dev/google/universal-sentence-encoder-large/3?tf-hub-format=compressed)]
2. Decompress and put `assets`, `variables`, `saved_model.pb` and `tfhub_module.pb` under `model/pretrained/universal_sentence_encoder` directory
### Step 5: Download OpenNMT toolkit for PyTorch
Change to the root directory `Question-Generation/` and follow the instructions at this [link](http://opennmt.net/OpenNMT-py/main.html#installation).

## Usage
To execute the whole pipeline:
```
python main.py config_file_path
```
To execute individual script:
```
python main.py [--script SCRIPT] config_file_path
```
### Available Scripts

#### `build_parallel`
##### Description 
Build pseudo-parallel corpus from 2 unaligned corpus. 
##### Configuration
 - `src`: Path to unaligned corpus (source)
 - `tgt`: Path to unaligned corpus (target)
 - `encoder`: Sentence encoder. Choose between `fasttext`, `glove` or `use` (Universal Sentence Encoder)
 - `parallel_src`: Path where the generated pseudo-parallel corpus (source) will be saved
 - `parallel_tgt`: Path where the generated pseudo-parallel corpus (target) will be saved
 
#### `prepare_dataset`
##### Description 
Split dataset into train, test, validation set for `preprocess` script. 
##### Configuration
 - `input_src`: Path to pseudo-parallel corpus (source)
 - `input_tgt`: Path to pseudo-parallel corpus (target)
 - `train_src`: Path where the training set (source) will be saved
 - `train_tgt`: Path where the training set (target) will be saved
 - `valid_src`: Path where the validation set (source) will be saved
 - `valid_tgt`: Path where the validation set (target) will be saved
 - `test_src`: Path where the testing set (source) will be saved
 - `test_tgt`: Path where the testing set (target) will be saved
 - `validation_ratio`: Ratio of validation set to be split from input data set
 - `test_ratio`: Ratio of testing set to be split from input data set
 
#### `preprocess`
##### Description 
Extract feature and build vocabulary from source and target corpus. Requires OpenNMT to be installed. 
##### Configuration
Refer to this [link](http://opennmt.net/OpenNMT-py/options/preprocess.html)

#### `train`
##### Description 
Train a neural machine translation model. Requires OpenNMT to be installed. 
##### Configuration
Refer to this [link](http://opennmt.net/OpenNMT-py/options/train.html)

#### `translate`
##### Description 
Run inference using trained neural machine translation model. Requires OpenNMT to be installed. 
##### Configuration
Refer to this [link](http://opennmt.net/OpenNMT-py/options/translate.html)

#### `format_output`
##### Description 
Format output generated by the `translate` script into a JSON file where each source sentence maps to list of "translated" sentences.
##### Configuration
 - `src`: Path to testing set
 - `tgt`: Path to output file generated by `translate` script
 - `output`: Path where the formatted JSON file will be saved

### Configuration file
The provided `main.py` script reads all configuration settings from a single yaml file. To get started, copy the provided `sample_config.yml` file in the `config` folder and modify the value of each parameter accordingly. Each parameter is prefixed by the name of the script that consumes the parameter. For example, `build_parallel-src` indicates the parameter `src`, consumed as input by `build_parallel` script.